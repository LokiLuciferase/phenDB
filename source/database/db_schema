
PRAGMA foreign_keys = ON;

CREATE TABLE JOB (
  job_id TEXT PRIMARY KEY,
  user_ip TEXT,
  user_email TEXT,
  job_date DATE,
  folder_path TEXT,
  job_status TEXT
);

CREATE TABLE BIN (
  bin_id TEXT,
  job_id TEXT,
  genome_path TEXT,
  mdsum TEXT PRIMARY KEY,
  errors TEXT,
  FOREIGN KEY(job_id) REFERENCES JOB(job_id)
);

CREATE TABLE ENOG (
  enog_id TEXT PRIMARY KEY,
  enog_description TEXT
);

CREATE TABLE MODEL (
  model_id TEXT PRIMARY KEY,
  model_description TEXT,
  model_version_nr TEXT,
  train_date DATE,

);

CREATE TABLE MODEL_ENOG_RANKS (
  model_id TEXT,
  enog_id TEXT,
  internal_rank INTEGER,
  FOREIGN KEY(model_id) REFERENCES MODEL(model_id),
  FOREIGN KEY(enog_id) REFERENCES ENOG(enog_id)
  PRIMARY KEY(model_id, enog_id)
);

CREATE TABLE RESULT_ENOG (
  enog_id TEXT,
  mdsum TEXT,
  FOREIGN KEY(enog_id) REFERENCES MODEL(enog_id),
  FOREIGN KEY(mdsum) REFERENCES BIN(mdsum)
  PRIMARY KEY(enog_id, mdsum)

);

CREATE TABLE RESULT_MODEL (
  mdsum TEXT,
  model_id TEXT,
  model_version_nr TEXT,
  verdict BOOLEAN,
  accuracy REAL,
  train_date DATE,
  FOREIGN KEY(model_id) REFERENCES MODEL(model_id),
  FOREIGN_KEY(model_version_nr) REFERENCES MODEL(model_version_nr),
  FOREIGN KEY(mdsum) REFERENCES BIN(mdsum),
  FOREIGN KEY(train_date) REFERENCES MODEL(train_date)
  PRIMARY KEY(mdsum, model_id, model_version_nr,)
);
