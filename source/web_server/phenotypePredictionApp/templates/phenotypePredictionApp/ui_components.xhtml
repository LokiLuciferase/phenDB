{% load boolean_js %}

<script>

$(document).ready(function() {
    __initialize_popups({{ showProgressBar | boolean_js | safe }});
    __initialize_widgets();
    __initialize_error_messages();
    __initialize_controls();
    __initialize_accordions();
    __initialize_fieldsets();
});

//TODO: seperate progressbar
function __initialize_popups(showProgressBar) {
        $('#overlay').puidialog({
                 closable: false,
                 minimizable: false,
                 maximizable: false,
                 modal: true,
                 resizable: false
             });
            if(showProgressBar) {
                $('#overlay').puidialog('show');
                $('#progressbar').puiprogressbar({
                    value : {{  progress|default:0}},
                    {% if queuePos > 0 %}
                        labelTemplate: "Queue: {{ queuePos }} job(s) ahead of your job",
                    {% elif total_bins != 0  %}
                        labelTemplate: "Finished/Total: " + "{{ finished_bins }}/{{ total_bins }}",
                    {% endif %}
                });
            }
        $('#queue_info').puidialog({
                 minimizable: false,
                 maximizable: false,
                 resizable: false
            });
}

function __initialize_accordions() {
    $('#all_result_tables').puiaccordion();
}

function __initialize_fieldsets() {
    $('#input_section_advanced').puifieldset({
        toggleable: true,
        collapsed: true,
    });
}

function __initialize_widgets() {
    $('#input_section').puipanel();
    $('#requested_balac').puispinner({
        min: 0.5,
        max: 1,
        step: 0.01
    });
    $('#requested_conf').puispinner({
        min: 0.5,
        max: 1,
        step: 0.01
    });
    $('#result_download').puipanel();
    $('#result_figure_trait_prediction').puipanel({closable:false, collapsed:false});
    $('#results_advanced').puipanel({collapsed:true, toggleable:true});
}

function __initialize_error_messages() {
    $('#error_message').puigrowl({sticky:true});
    {% if showErrorMessage %}
        $('#error_message').puigrowl('show', [{severity: '{{ errorSeverityPU }}', summary: '{{ errorSummaryPU }}', detail: '{{ errorMessagePU }}' } ]);
    {% endif %}
}

function __initialize_controls() {
    $('#queue_show').puibutton({
                icon: 'fa-external-link-square',
                click: function() {
                    $('#queue_info').puidialog('show');
                }
            });
    $('#dt_results_model_filter_info').puibutton({
            icon: 'fa-external-link-square',
            click: function() {
                window.open("http://phendb.csb.univie.ac.at/reports/modeloverview");
            }
        });
    $('#get_help').puibutton({
        icon: 'fa-external-link-square',
            click: function() {
                window.open("http://phendb.csb.univie.ac.at/help");
            }
    });
    $('#browse_phendb').puibutton ({
        icon: 'fa-external-link-square',
            click: function() {
                window.open("http://phendb.csb.univie.ac.at/browse-phendb");
            }
    });
    $('#about_phendb').puibutton ({
        icon: 'fa-external-link-square',
            click: function() {
                window.open("http://phendb.csb.univie.ac.at/methods");
            }
    });
    $('#results_advanced_submit').puibutton({
        icon: 'fa-external-link-square',
            click: function() {
                updateDatatablesWithAjax();
            }
    });
    $('#dt_results_pval_filter').puispinner({step:0.05});
    $('#dt_results_accuracy_filter').puispinner({step:0.05});
}

function click_on_example_data_checkbox() {
    var fileInputElm = document.getElementById('fileInput');
    var example_data_button_elm = document.getElementById('example_data_button');
    if(fileInputElm.disabled) {
        fileInputElm.disabled = false;
    }
    else {
        fileInputElm.disabled = true;
        var infobox = function() => alert("Escherichia coli str. K-12 substr. MG1655 (Refseq accession GCF 000005845.2) will be used in this example");
        setTimeout(infobox, 500);
    }
}

function click_on_disable_cutoffs_checkbox() {
    var balancedAccuracyElm = document.getElementById('requested_balac');
    if(balancedAccuracyElm.disabled){
        $('#requested_balac').puispinner('enable');
        $('#requested_conf').puispinner('enable');
    }
    else {
        $('#requested_balac').puispinner('disable');
        $('#requested_conf').puispinner('disable');
    }
}

function showAjaxLoader() {
    document.getElementById('loading_gif_container').style.display = "block";
    document.getElementById('white_overlay').style.display = "block";
}

function disableAjaxLoader() {
    document.getElementById('loading_gif_container').style.display = "none";
    document.getElementById('white_overlay').style.display = "none";
}

</script>